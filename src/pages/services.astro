---
import BaseLayout from '../layouts/BaseLayout.astro';
import site from '../content/site-config.json';
import { assetPath } from '../utils/paths';

const services = (site as any).servicesPage ?? {};
const hero = services.hero ?? {};
const expertise = services.expertise ?? {};
const additional = services.additional ?? {};
const portfolio = services.portfolio ?? {};
const contact = services.contact ?? {};
---

<BaseLayout title="Services">
	<!-- Hero Section -->
	<section aria-labelledby="services-hero-heading" class="relative isolate overflow-hidden">
		<!-- Background image (includes blue bar on left) -->
		<div class="absolute inset-0">
			<div
				class="absolute inset-0 w-full h-full bg-cover bg-center"
				style={`background-image: url(${assetPath(hero.backgroundImage ?? '/assets/images/hero-background.jpg')})`}
			></div>
		</div>
		<!-- Content -->
		<div class="relative z-20 flex items-start justify-center min-h-[85vh] sm:min-h-[90vh] pt-16 sm:pt-20 md:pt-24 pb-20">
			<div class="max-w-2xl lg:max-w-3xl px-6 sm:px-8 text-center mx-auto">
				<h1 id="services-hero-heading" class="font-light tracking-wide text-slate-900 font-serif leading-tight" style="font-size: calc(2.2vw + 1.2rem);">
					<span class="block whitespace-nowrap">{hero.titleLine1}</span>
					<span class="block whitespace-nowrap">{hero.titleLine2} <em class="italic">{hero.titleItalic}</em></span>
				</h1>
				<p class="mt-8 sm:mt-10 text-lg sm:text-xl md:text-2xl text-slate-800 font-sans font-bold text-justify" style="line-height: 1.8;">
					{hero.subtitle}
				</p>
			</div>
		</div>
	</section>

	<!-- Areas of Expertise Section -->
	<section aria-labelledby="expertise-heading" class="py-16 sm:py-20 md:py-24 bg-white">
		<div class="mx-auto max-w-[1200px] px-[4vw]">
			<h2 id="expertise-heading" class="text-center text-slate-900 font-serif mb-12 sm:mb-16" style="font-size: calc(2.2vw + 1.2rem);">
				<span class="font-normal">{expertise.title}</span>
				<span class="italic ml-2">{expertise.titleItalic}</span>
			</h2>
			<div class="grid grid-cols-1 lg:grid-cols-2 gap-10 lg:gap-16 items-start">
				<!-- Image -->
				<div>
					<img
						src={assetPath("/assets/images/expertise-photo.webp")}
						alt="Professional working at desk"
						class="w-full h-auto"
						loading="lazy"
						decoding="async"
					/>
				</div>
				<!-- List -->
				<ul class="space-y-6 sm:space-y-8 pt-4">
					{(expertise.items ?? []).map((item: string) => (
						<li class="flex items-start gap-3 text-slate-900 text-lg sm:text-xl md:text-2xl font-sans font-bold">
							<span class="text-slate-900 flex-shrink-0 text-sm" style="margin-top: 0.45em;">•</span>
							<span>{item}</span>
						</li>
					))}
				</ul>
			</div>
		</div>
	</section>

	<!-- We Also Help With Section -->
	<section aria-labelledby="additional-heading" class="py-16 sm:py-20 md:py-24 bg-white">
		<div class="mx-auto max-w-[1200px] px-[4vw]">
			<h2 id="additional-heading" class="text-center text-slate-900 font-serif mb-12 sm:mb-16" style="font-size: calc(2.2vw + 1.2rem);">
				{additional.title}
			</h2>
			<div class="grid grid-cols-1 md:grid-cols-2 gap-0">
				<!-- Left Column -->
				<div class="pr-0 md:pr-12 md:border-r border-slate-300">
					<img
						src={assetPath("/assets/images/service-brand.jpg")}
						alt="Brand and reputation building"
						class="w-full h-auto mb-8"
						loading="lazy"
						decoding="async"
					/>
					<ul class="space-y-6">
						<li class="flex items-start gap-3 text-slate-900 text-lg sm:text-xl md:text-2xl font-sans font-bold">
							<span class="text-slate-900 flex-shrink-0 text-sm" style="margin-top: 0.45em;">•</span>
							<span>Brand & Reputation Building</span>
						</li>
						<li class="flex items-start gap-3 text-slate-900 text-lg sm:text-xl md:text-2xl font-sans font-bold">
							<span class="text-slate-900 flex-shrink-0 text-sm" style="margin-top: 0.45em;">•</span>
							<span>Event Sponsorships</span>
						</li>
					</ul>
				</div>
				<!-- Right Column -->
				<div class="pl-0 md:pl-12 mt-12 md:mt-0">
					<img
						src={assetPath("/assets/images/service-social.jpg")}
						alt="Social media strategy"
						class="w-full h-auto mb-8"
						loading="lazy"
						decoding="async"
					/>
					<ul class="space-y-6">
						<li class="flex items-start gap-3 text-slate-900 text-lg sm:text-xl md:text-2xl font-sans font-bold">
							<span class="text-slate-900 flex-shrink-0 text-sm" style="margin-top: 0.45em;">•</span>
							<span>Social Media Strategy</span>
						</li>
						<li class="flex items-start gap-3 text-slate-900 text-lg sm:text-xl md:text-2xl font-sans font-bold">
							<span class="text-slate-900 flex-shrink-0 text-sm" style="margin-top: 0.45em;">•</span>
							<span>Internal Engagement & Communications</span>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</section>

	<!-- Company Description Section -->
	<section aria-labelledby="company-description" class="relative py-24 sm:py-32 md:py-40 overflow-hidden">
		<!-- Animated background -->
		<div class="absolute inset-0">
			<div
				id="company-bg"
				class="absolute inset-0 w-[120%] h-[120%] -left-[10%] -top-[10%] bg-cover bg-center"
				style={`background-image: url('${assetPath("/assets/images/company-description-bg.jpg")}');`}
			></div>
		</div>
		<!-- Content -->
		<div class="relative z-10 mx-auto max-w-[1000px] px-[4vw]">
			<p class="text-white text-lg sm:text-xl md:text-2xl font-sans font-bold leading-relaxed" style="line-height: 1.8;">
				SJS Communications is an independently owned and run consulting firm that brings science to life through creative and authentic communication strategies.
			</p>
			<p class="mt-6 text-white text-lg sm:text-xl md:text-2xl font-sans font-bold leading-relaxed" style="line-height: 1.8;">
				We love the work we do and are seeking clients who are equally as passionate and results-driven. And it's definitely a plus if they like to have fun!
			</p>
		</div>
	</section>

	<style>
		@keyframes undulate {
			0%, 100% {
				transform: scale(1.05) translate(0%, 0%);
			}
			25% {
				transform: scale(1.1) translate(-2%, -1%);
			}
			50% {
				transform: scale(1.05) translate(0%, -2%);
			}
			75% {
				transform: scale(1.1) translate(2%, -1%);
			}
		}

		#company-bg {
			animation: undulate 20s ease-in-out infinite;
		}

		@media (prefers-reduced-motion: reduce) {
			#company-bg {
				animation: none;
			}
		}
	</style>

	<!-- Sarah In Action Portfolio Section -->
	<section aria-labelledby="portfolio-heading" class="py-16 sm:py-20 md:py-24 bg-slate-100">
		<div class="mx-auto max-w-[1200px] px-[4vw]">
			<h2 id="portfolio-heading" class="text-center text-slate-900 font-serif mb-10 sm:mb-14" style="font-size: calc(2.2vw + 1.2rem);">
				<span class="font-normal">{portfolio.title}</span>
				<span class="italic ml-2">{portfolio.titleItalic}</span>
			</h2>

			<!-- Portfolio Grid -->
			<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
				{(portfolio.items ?? []).map((item: { title: string; image: string; type: string }, idx: number) => (
					<figure
						class="portfolio-item group relative overflow-hidden rounded-lg aspect-[16/10] bg-slate-200 cursor-pointer"
						data-index={idx}
						data-image={assetPath(item.image)}
						data-title={item.title}
					>
						<img
							src={assetPath(item.image)}
							alt={item.title}
							class="absolute inset-0 w-full h-full object-cover transition-transform duration-300 group-hover:scale-105"
							loading="lazy"
							decoding="async"
							onerror="this.style.display='none'"
						/>
						<div class="absolute inset-0 bg-slate-900/0 group-hover:bg-slate-900/20 transition-colors duration-300"></div>
					</figure>
				))}
			</div>
		</div>

		<!-- Lightbox Modal -->
		<div id="lightbox" class="fixed inset-0 z-50 hidden items-center justify-center p-4 lightbox-backdrop">
			<button
				id="lightbox-close"
				class="absolute top-4 right-4 text-white hover:text-slate-300 transition p-2 z-10 lightbox-close-btn"
				aria-label="Close lightbox"
			>
				<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="w-8 h-8">
					<path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
				</svg>
			</button>
			<img
				id="lightbox-image"
				src=""
				alt=""
				class="max-w-full max-h-[90vh] object-contain lightbox-image"
			/>
		</div>
	</section>

	<style>
		.lightbox-backdrop {
			background-color: rgba(0, 0, 0, 0);
			transition: background-color 0.3s ease-out;
		}

		.lightbox-backdrop.active {
			background-color: rgba(0, 0, 0, 0.45);
		}

		.lightbox-image {
			opacity: 0;
			transform: scale(0.8);
			transition: opacity 0.3s ease-out, transform 0.3s ease-out;
		}

		.lightbox-backdrop.active .lightbox-image {
			opacity: 1;
			transform: scale(1);
		}

		.lightbox-close-btn {
			opacity: 0;
			transition: opacity 0.3s ease-out 0.1s;
		}

		.lightbox-backdrop.active .lightbox-close-btn {
			opacity: 1;
		}
	</style>

	<!-- Contact Section -->
	<section aria-labelledby="services-contact-heading" class="py-16 sm:py-20 md:py-24 bg-white">
		<!-- Sarah Image - full width -->
		<div class="mx-auto max-w-[1100px] px-[4vw] mb-10 sm:mb-14">
			<img
				src={assetPath("/assets/images/sarah-contact.jpg")}
				alt="Sarah Spencer at her desk"
				class="w-full h-auto"
				loading="lazy"
				decoding="async"
			/>
		</div>
		<!-- Heading and CTA -->
		<div class="mx-auto max-w-[1100px] px-[4vw]">
			<h2 id="services-contact-heading" class="text-left text-slate-900 font-serif mb-10 sm:mb-14 whitespace-nowrap" style="font-size: calc(2.2vw + 1.2rem);">
				<span class="font-normal">{contact.title}</span>
				<em class="italic ml-2">{contact.titleItalic} {contact.titleItalic2}</em>
			</h2>

			<div class="text-center">
				<a
					href={`mailto:${site.site.email}?subject=Inquiry from SJS Communications Website`}
					class="inline-block rounded-full font-serif font-light text-white bg-[#4F3F90] hover:bg-[#3d3070] px-10 py-3 text-lg tracking-wider transition-colors"
				>
					SEND US AN EMAIL
				</a>
				<p class="mt-6 text-slate-600">
					Or reach out directly at <a href={`mailto:${site.site.email}`} class="text-[#1399D7] hover:underline font-medium">{site.site.email}</a>
				</p>
			</div>
		</div>
	</section>

</BaseLayout>

<script>
	// Lightbox functionality
	const lightbox = document.getElementById('lightbox');
	const lightboxImage = document.getElementById('lightbox-image') as HTMLImageElement;
	const lightboxClose = document.getElementById('lightbox-close');
	const portfolioItems = document.querySelectorAll('.portfolio-item');

	function openLightbox(imageSrc: string, imageAlt: string) {
		if (!lightbox || !lightboxImage) return;
		lightboxImage.src = imageSrc;
		lightboxImage.alt = imageAlt;
		lightbox.classList.remove('hidden');
		lightbox.classList.add('flex');
		document.body.style.overflow = 'hidden';
		// Trigger animation on next frame
		requestAnimationFrame(() => {
			lightbox.classList.add('active');
		});
	}

	function closeLightbox() {
		if (!lightbox) return;
		lightbox.classList.remove('active');
		document.body.style.overflow = '';
		// Wait for animation to complete before hiding
		setTimeout(() => {
			lightbox.classList.add('hidden');
			lightbox.classList.remove('flex');
		}, 300);
	}

	portfolioItems.forEach(item => {
		item.addEventListener('click', () => {
			const imageSrc = (item as HTMLElement).dataset.image || '';
			const imageTitle = (item as HTMLElement).dataset.title || '';
			openLightbox(imageSrc, imageTitle);
		});
	});

	lightboxClose?.addEventListener('click', closeLightbox);

	lightbox?.addEventListener('click', (e) => {
		if (e.target === lightbox) {
			closeLightbox();
		}
	});

	document.addEventListener('keydown', (e) => {
		if (e.key === 'Escape') {
			closeLightbox();
		}
	});
</script>
